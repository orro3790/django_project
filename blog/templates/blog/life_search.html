{% extends "blog/base.html" %}
{% block nav_item_life-blog-search %}active{% endblock nav_item_life-blog-search %} 
{% load crispy_forms_tags %}
{% block content %}
{% load static %}
{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}

{% trans "Is Russia Safe? Is Russian food good? Is Moscow expensive? Do Russians speak English? Get the answers from two Canadians who moved there! If you're curious about life in Moscow, you came to the right place." as meta_tag %}

<head>
  <meta name="description" content={{meta_tag}}>
  <title>Life in Moscow</title>
</head>

<!-- Masonry -->
<script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script src="/django_project/blog/static/blog/js/masonry.pkgd.min.js"></script>
<script src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>



<section id="carousel-section">
  <div class="container-fluid px-0">
    <div id="foodsearch-banner" class="carousel slide carousel-fade" data-ride="carousel">
      <ol class="carousel-indicators d-none">
          <li data-target="#foodsearch-banner" data-slide-to="0" class="active"></li>
          <li data-target="#foodsearch-banner" data-slide-to="1"></li>
          <li data-target="#foodsearch-banner" data-slide-to="2"></li>
        </ol>
      <div class="carousel-inner">
          <div class="carousel-item active">
            {% for image in carousel_images %}
              {% if image.slide_number == 'First' %}
                {% if LANGUAGE_CODE == 'en' %}
                  <a href="{{ image.link }}" class="stretched-link">
                    <img class="d-block w-100" src="{{ image.image.url }}" alt="First slide">
                    <div class="carousel-caption carousel-caption-center d-lg-flex d-none">
                      <h4>
                        {{ image.title }}
                      </h4>
                      <p>
                        {{ image.caption }}
                      </p>
                    </div>
                  </a>
                {% elif LANGUAGE_CODE == 'ru' %}
                  <a href="{{ image.link_russian }}" class="stretched-link">
                    <img class="d-block w-100" src="{{ image.image.url }}" alt="First slide">
                    <div class="carousel-caption carousel-caption-center d-lg-flex d-none">
                      <h4>
                        {{ image.title_russian }}
                      </h4>
                      <p>
                        {{ image.caption_russian }}
                      </p>
                    </div>
                  </a>
                {% endif %}
              {% endif %}
            {% endfor %}
          </div>
          <div class="carousel-item">
            {% for image in carousel_images %}
              {% if image.slide_number == 'Second' %}
                {% if LANGUAGE_CODE == 'en' %}
                  <a href="{{ image.link }}" class="stretched-link">
                    <img class="d-block w-100" src="{{ image.image.url }}" alt="First slide">
                    <div class="carousel-caption carousel-caption-center d-lg-flex d-none">
                      <h4>
                        {{ image.title }}
                      </h4>
                      <p>
                        {{ image.caption }}
                      </p>
                    </div>
                  </a>
                {% elif LANGUAGE_CODE == 'ru' %}
                  <a href="{{ image.link_russian }}" class="stretched-link">
                    <img class="d-block w-100" src="{{ image.image.url }}" alt="First slide">
                    <div class="carousel-caption carousel-caption-center d-lg-flex d-none">
                      <h4>
                        {{ image.title_russian }}
                      </h4>
                      <p>
                        {{ image.caption_russian }}
                      </p>
                    </div>
                  </a>
                {% endif %}
              {% endif %}
            {% endfor %}
          </div>
          <div class="carousel-item">
            {% for image in carousel_images %}
              {% if image.slide_number == 'Third' %}
                {% if LANGUAGE_CODE == 'en' %}
                  <a href="{{ image.link }}" class="stretched-link">
                    <img class="d-block w-100" src="{{ image.image.url }}" alt="First slide">
                    <div class="carousel-caption carousel-caption-center d-lg-flex d-none">
                      <h4>
                        {{ image.title }}
                      </h4 >
                      <p>
                        {{ image.caption }}
                      </p>
                    </div>
                  </a>
                {% elif LANGUAGE_CODE == 'ru' %}
                  <a href="{{ image.link_russian }}" class="stretched-link">
                    <img class="d-block w-100" src="{{ image.image.url }}" alt="First slide">
                    <div class="carousel-caption carousel-caption-center d-lg-flex d-none">
                      <h4>
                        {{ image.title_russian }}
                      </h4>
                      <p>
                        {{ image.caption_russian }}
                      </p>
                    </div>
                  </a>
                {% endif %}
              {% endif %}
            {% endfor %}
          </div>
        </div>
      <a class="carousel-control-prev d-none" href="#foodsearch-banner" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
      </a>
      <a class="carousel-control-next d-none" href="#foodsearch-banner" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
      </a>
    </div>
  </div>
</section>

<!-- Search Section Starts -->
<section id="search-fields" class="d-none d-md-flex">
  <form class="justify-content-center align-items-center" style="width: 600px;">
    <div class="inner-form">

      <!-- Search by keyword -->
      <div class="input-field first-wrap">
        <input type="text" name="keyword" placeholder={% trans "Keyword..." %} value={% if keyword_query %}
                {{keyword_query}}
              {% else %}
                ""
              {% endif %}/>
      </div>
      
      <!-- Search by blog type -->
      <select class="input-field middle-wrap" id="blog_category" name="blog_category">
        <option selected>
          {% if blog_category_query %}
            {{ blog_category_query }}
          {% else %}
            {% trans "Category..." %}
          {% endif %}
        </option>
        {% if LANGUAGE_CODE == "en" %}
          {% for type in blog_category %}
            <option value="{{ type }}">
              {{ type }}
            </option>
          {% endfor %}
        {% elif LANGUAGE_CODE == "ru" %}
          {% for type in blog_category_russian %}
            <option value="{{ type }}">
              {{ type }}
            </option>
          {% endfor %}
        {% endif %}
      </select>
            

      <!-- Search by tags -->
      <select id="tags" class="input-field last-wrap" name="tags">
        <option selected>
          {% if tags_query %}
            {{ tags_query }}
          {% else %}
            {% trans "Tags..." %}
          {% endif %}
        </option>
        {% if LANGUAGE_CODE == "en" %}
          {% for tag in tags %}
            <option value="{{ tag }}">
              {{ tag }}
            </option>
          {% endfor %}
        {% elif LANGUAGE_CODE == "ru" %}
          {% for tag in tags_russian %}
            <option value="{{ tag }}">
              {{ tag }}
            </option>
          {% endfor %}
        {% endif %}
      </select>

      <!-- Search button -->
      <div class="input-field search-button-wrap">
        <button type="submit" class="btn-search" value="Filter">
          <i class="fas fa-search"></i>
        </button>
      </div>

      <!-- Reset button -->
      <div class="input-field reset-button-wrap">
        <button type="button" class="btn-reset" onclick="window.location.href='{% url 'life-blog-search' %}'">
          <i class="fas fa-undo"></i>
        </button>
      </div>
      
    </div> <!-- inner-form ends -->
  </form>
</section>

<!-- Search Section Mobile View -->
<form method="GET" action="." class="d-md-none d-sm-block">
  <div class="container py-3">
    <div class="row">
    <!-- Search by Title -->
      <div class="col-12 text-center">
        <div class="input-group">
          <input class="form-control form-control-sm border" type="search" name="keyword" placeholder="Keyword..." />
        </div>
      </div>
    <!-- Search by blog type -->
      <div class="col-12">
        <select id="blog_category" class="custom-select custom-select-sm" name="blog_category">
          <option selected>
            {% trans "Category..." %}
          </option>
          {% if LANGUAGE_CODE == "en" %}
            {% for type in blog_category %}
              <option value="{{ type }}">
                {{ type }}
              </option>
            {% endfor %}
          {% elif LANGUAGE_CODE == "ru" %}
            {% for type in blog_category_russian %}
              <option value="{{ type }}">
                {{ type }}
              </option>
            {% endfor %}
          {% endif %}
        </select>
      </div>

      <!-- Search by tags -->
      <div class="col-12">
        <select id="tags" class="custom-select custom-select-sm" name="tags">
          <option selected>
            {% trans "Tags..." %}
          </option>
          {% if LANGUAGE_CODE == "en" %}
            {% for tag in tags %}
              <option value="{{ tag }}">
                {{ tag }}
              </option>
            {% endfor %}
          {% elif LANGUAGE_CODE == "ru" %}
            {% for tag in tags_russian %}
              <option value="{{ tag }}">
                {{ tag }}
              </option>
            {% endfor %}
          {% endif %}
        </select>
      </div>
      
      <div class="container text-center py-2">
        <!-- Search button -->
        <button type="submit" class="btn-search-mobile" value="Filter">
          <i class="fas fa-search"></i>
        </button>

        <!-- Reset button -->
        <button type="button" class="btn-reset-mobile" onclick="window.location.href='{% url 'life-blog-search' %}'">
          <i class="fas fa-undo"></i>
        </button>
      </div>

    </div>
  </div>
</form>

<section id="search-results-text">
{% if LANGUAGE_CODE == "en" %}
  <!-- Outcome #1: Default view upon first page load -->
  {% if tags_query == None and blog_category_query == None and keyword_query == '' %}
    <div class="container text-center">
      {% if queryset.paginator.count == 0 %}
        <b>(0) Blogs</b>
      {% elif queryset.paginator.count == 1 %}
        <b>(1) Blog</b>
      {% elif queryset.paginator.count > 1 %}
        <b>({{ queryset.paginator.count }}) Blogs</b>
      {% endif %}
      <hr>
    </div>
      
  <!-- Outcome #2: A user presses search, but without any criteria selected -->
  {% elif tags_query == 'Tags...' and blog_category_query == 'Category...' and keyword_query == '' %}
    <div class="container text-center">
      {% if queryset.paginator.count == 0 %}
        <b>(0) Blogs</b>
      {% elif queryset.paginator.count == 1 %}
        <b>(1) Blog</b>
      {% elif queryset.paginator.count > 1 %}
        <b>({{ queryset.paginator.count }}) Blogs</b>
      {% endif %}
      <hr>
    </div>

    <!-- Outcome #3: A user searches with some combination of criteria selected-->
  {% else %}
    <div class="container text-center">
      {% if queryset.paginator.count == 0 %}
        <b>(0) Blogs</b>
      {% elif queryset.paginator.count == 1 %}
        <b>(1) Blog</b>
      {% elif queryset.paginator.count > 1 %}
        <b>({{ queryset.paginator.count }}) Blogs</b>
      {% endif %}
      <hr>
    </div>

    <!-- If there are no results, show this additional container -->
    {% if queryset.paginator.count == 0 %}
      <section id="no-search-results">
        <div class="container text-center">
          <h5>
            {% trans "Looking for something? Tell us and we'll blog about it for you!" %}
          </h5>
        </div>
        <div class="row py-5">
          <!-- Empty row -->
        </div>
      </section>
    {% endif %}
  {% endif %}
{% endif %}

<!-- Search result text for RUSSIAN users -->
{% if LANGUAGE_CODE == "ru" %}

  <!-- Outcome #1: Default view upon first page load -->
  {% if tags_query == None and blog_category_query == None and keyword_query == None %}
    <div class="container text-center">
      {% if queryset.paginator.count == 0 %}
        <b>(0) блогов</b> 
      {% elif queryset.paginator.count == 1 %}
        <b>(1) блог</b> 
      {% elif queryset.paginator.count|slice:":-1" == 2 or queryset.paginator.count|slice:":-1" == 3 or queryset.paginator.count|slice:":-1" == 4 %}
        <b>({{queryset.paginator.count}}) блога</b>
      {% elif queryset.paginator.count > 5 or queryset.paginator.count|slice:"-1" == 5 %}
        <b>({{queryset.paginator.count}}) блогов</b> 
      {% endif %}
        <hr>
    </div>

  <!-- Outcome #2: A user presses search, but without any criteria selected -->
  {% elif tags_query == 'Теги...' and blog_category_query == 'Категория...' and keyword_query == '' %}
    <div class="container text-center">
      {% if queryset.paginator.count == 0 %}
        <b>(0) блогов</b> 
      {% elif queryset.paginator.count == 1 %}
        <b>(1) блог</b> 
      {% elif queryset.paginator.count|slice:":-1" == 2 or queryset.paginator.count|slice:":-1" == 3 or queryset.paginator.count|slice:":-1" == 4 %}
        <b>({{queryset.paginator.count}}) блога</b>
      {% elif queryset.paginator.count > 5 or queryset.paginator.count|slice:"-1" == 5 %}
        <b>({{queryset.paginator.count}}) блогов</b> 
      {% endif %}
        <hr>
    </div>

  <!-- Outcome #3: A user searches with some combination of criteria selected-->
  {% else %}
    <div class="container text-center">
      {% if queryset.paginator.count == 0 %}
        <b>(0) блогов</b> 
      {% elif queryset.paginator.count == 1 %}
        <b>(1) блог</b> 
      {% elif queryset.paginator.count|slice:":-1" == 2 or queryset.paginator.count|slice:":-1" == 3 or queryset.paginator.count|slice:":-1" == 4 %}
        <b>({{queryset.paginator.count}}) блога</b>
      {% elif queryset.paginator.count > 5 or queryset.paginator.count|slice:"-1" == 5 %}
        <b>({{queryset.paginator.count}}) блогов</b> 
      {% endif %}
        <hr>
    </div>

    <!-- If there are no results, show this additional container -->
    {% if queryset.paginator.count == 0 %}
      <div class="container text-center">
        <h5>
          {% trans "Looking for something? Tell us and we'll blog about it for you!" %}
        </h5>
      </div>
      <div class="row py-5">
        <!-- Empty row -->
      </div>
    {% endif %}
  {% endif %}
{% endif %}
</section>

<!-- Russian Cards -->
{% if LANGUAGE_CODE == 'ru' %}
  <div class="container-fluid" style="padding-left: 5%; padding-right: 5%;">
    <div class="grid">
      <div class="grid-sizer col-xs col-md-6 col-lg-3"></div>
      {% for post in queryset %}
        <div class="grid-item col-xs col-md-6 col-lg-3">
          <a href="{% url 'life-blog-detail' post.id %}" class="card stretched-link card-hover">
          <img src="{{ post.card_image.url }}" alt="" class="card-img-top">
          <span class="badge badge-pill notify-badge badge-light">
            {{ post.blog_category_russian.get }}
          </span>
          <div class="card-body">
            <h4 class="card-title">
            {{ post.title_russian }}
          </h4>
          <hr>
          <p class="card-text">
            {{ post.card_content_russian }}
          </p>
          <div class="text-center">
            <i class="fas fa-comments"></i>  {{ post.lifeblogcomment_set.all.count }}
          </div>
          <hr>
          <footer class="blockquote-footer text-center ">
            <cite title="Source Title">{% trans "Posted on" %} {{ post.date_posted|date:"m/d/Y" }}</cite>
          </footer>
          </div>
          </a>
        </div>
      {% endfor %}
    </div>
  </div>
{% endif %}

<!-- English Cards -->
{% if LANGUAGE_CODE == 'en' %}
  <div class="container-fluid" style="padding-left: 5%; padding-right: 5%;">
    <div class="grid">
      <div class="grid-sizer col-xs col-md-6 col-lg-3"></div>
      {% for post in queryset %}
        <div class="grid-item col-xs col-md-6 col-lg-3">
          <a href="{% url 'life-blog-detail' post.id %}" class="card stretched-link card-hover">
          <img src="{{ post.card_image.url }}" alt="" class="card-img-top">
          <span class="badge badge-pill notify-badge badge-light">
            {{ post.blog_category.get }}
          </span>
          <div class="card-body">
            <h4 class="card-title">
            {{ post.title }}
          </h4>
          <hr>
          <p class="card-text">
            {{ post.card_content }}
          </p>
          <div class="text-center">
            <i class="fas fa-comments"></i>  {{ post.lifeblogcomment_set.all.count }}
          </div>
          <hr>
          <footer class="blockquote-footer text-center ">
            <cite title="Source Title">{% trans "Posted on" %} {{ post.date_posted|date:"m/d/Y" }}</cite>
          </footer>
          </div>
          </a>
        </div>
      {% endfor %}
    </div>
  </div>
{% endif %}

<!-- Pagination -->
<section id="paginate-buttons" class="container text-center my-5">
  <div class="row">
    <div class="col">
      {% if queryset.paginator.num_pages > 1 %}
        <div class="container pb-5 d-inline-block">
          {% if queryset.has_previous and keyword_query == '' %}
            <a href="?page={{ queryset.previous_page_number }}&title=&blog_category={{blog_category_query}}&tags={{tags_query}}" class="btn btn-sm btn-outline-dark"><i class="fas fa-angle-left"></i></a>
          {% endif %}

          {% if queryset.has_previous and keyword_query %}
            <a href="?page={{ queryset.previous_page_number }}&title={{keyword_query}}&blog_category={{blog_category_query}}&tags={{tags_query}}" class="btn btn-sm btn-outline-dark"><i class="fas fa-angle-left"></i></a>
          {% endif %}

          {% if queryset.has_previous and tags_query == None and blog_category_query == None and keyword_query == None %}
            <a href="?page={{ queryset.previous_page_number }}" class="btn btn-sm btn-outline-dark"><i class="fas fa-angle-left"></i></a>
          {% endif %} 

          {% for num in queryset.paginator.page_range %}
            {% if queryset.number == num %}
              {% if queryset.paginator.num_pages != 1 %}
                <a class="btn btn-sm btn-dark" href="?page={{ num }}">{{ num }}</a>
              {% endif %}
            {% endif %}
          {% endfor %}
          
          {% if queryset.has_next and keyword_query == '' %}
            <a href="?page={{ queryset.next_page_number }}&title=&blog_category={{blog_category_query}}&tags={{tags_query}}" class="btn btn-sm btn-outline-dark"><i class="fas fa-angle-right"></i></a>
          {% endif %}

          {% if queryset.has_next and keyword_query %}
            <a href="?page={{ queryset.next_page_number }}&title={{keyword_query}}&blog_category={{blog_category_query}}&tags={{tags_query}}" class="btn btn-sm btn-outline-dark"><i class="fas fa-angle-right"></i></a>
          {% endif %}

          {% if queryset.has_next and tags_query == None and blog_category_query == None and keyword_query == None %}
            <a href="?page={{ queryset.next_page_number }}" class="btn btn-sm btn-outline-dark"><i class="fas fa-angle-right"></i></a>
          {% endif %} 
        </div>
      {% endif %}
    </div>
  </div>
</section>

<!-- Masonry Script -->
<script>
  // init Masonry
  var $grid = $('.grid').masonry({
    itemSelector: '.grid-item', // use a separate class for itemSelector, other than .col-
    columnWidth: '.grid-sizer',
    percentPosition: true,
  });
  // layout Masonry after each image loads
  $grid.imagesLoaded().progress( function() {
    $grid.masonry('layout');
  });
</script>

{% endblock %}

